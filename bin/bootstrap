#!/usr/bin/env bb
;; -*- mode: clojure -*-

;; bootstrap the mj binary
(require '[clojure.java.shell :refer [sh]])

(when-not (System/getenv "GRAALVM_HOME")
  (binding [*out* *err*]
    (println "Please set GRAALVM_HOME"))
  (System/exit 1))

(println "generating binary (may take a couple of minutes)")
(let [res (sh "clojure" "-m" "makejack.main" "--verbose" "build")]
  (when (pos? (:exit res))
    (binding [*out* *err*]
      (println (:err res)))
    (System/exit (:exit res))))
